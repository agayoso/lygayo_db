USE RSH
GO

ALTER TABLE RSH_BASE
ADD ed0504 VARCHAR(4) NULL
GO

UPDATE RSH_BASE
SET ed0504 = RIGHT('00'+CAST(ed05 AS VARCHAR(2)),2) + RIGHT('00'+CAST(ed04 AS VARCHAR(2)),2)
GO

ALTER TABLE RSH_BASE
ADD a�oest INT NULL
GO

UPDATE RSH_BASE
SET a�oest = CASE
	WHEN ed0504 = '0000' OR (ed0504 >= '0110' AND ed0504 <= '0212') OR ed0504 = '1900' THEN 0
	WHEN (p09 >= 5 AND ed03 = 6) THEN 0
	WHEN (ed0504 = '0101' OR ed0504 = '0301') THEN 1
	WHEN (ed0504 = '0102' OR ed0504 = '0302' OR ed0504 = '1801') THEN 2
	WHEN (ed0504 = '0103' OR ed0504 = '1201' OR ed0504 = '0303') THEN 3
	WHEN (ed0504 = '0104' OR ed0504 = '0304') THEN 4
	WHEN (ed0504 = '0105' OR ed0504 = '0305' OR ed0504 = '1202') THEN 5
	WHEN (ed0504 = '0106' OR ed0504 = '0306' OR ed0504 = '1701' OR ed0504 = '1702' OR ed0504 = '1703') THEN 6
	WHEN (ed0504 = '0107' OR ed0504 = '0407' OR ed0504 = '0501' OR ed0504 = '1203' OR ed0504 = '1401') THEN 7
	WHEN (ed0504 = '0108' OR ed0504 = '0408' OR ed0504 = '0502' OR ed0504 = '1402') THEN 8
	WHEN (ed0504 = '0109' OR ed0504 = '0409' OR ed0504 = '0503' OR ed0504 = '1204' OR ed0504 = '1301' OR ed0504 = '1403' OR ed0504 = '1501' OR ed0504 = '1601') THEN 9
	WHEN (ed0504 = '0604' OR ed0504 = '0704' OR ed0504 = '0901' OR ed0504 = '1001' OR ed0504 = '1101' OR ed0504 = '1302' OR ed0504 = '1502' OR ed0504 = '1602') THEN 10
	WHEN (ed0504 = '0605' OR ed0504 = '0705' OR ed0504 = '0902' OR ed0504 = '1002' OR ed0504 = '1102' OR ed0504 = '1303' OR ed0504 = '1503' OR ed0504 = '1603') THEN 11
	WHEN (ed0504 = '0606' OR ed0504 = '0706' OR ed0504 = '0803' OR ed0504 = '0903' OR ed0504 = '1003' OR ed0504 = '1103' OR ed0504 = '1304' OR ed0504 = '1504' OR ed0504 = '1604' OR ed0504 = '2201') THEN 12
	WHEN (ed0504 = '0607' OR ed0504 = '2001' OR ed0504 = '2101' OR ed0504 = '2202' OR ed0504 = '2203' OR ed0504 = '2301' OR ed0504 = '2401') THEN 13
	WHEN (ed0504 = '2002' OR ed0504 = '2102' OR ed0504 = '2204' OR ed0504 = '2205' OR ed0504 = '2302' OR ed0504 = '2402') THEN 14
	WHEN (ed0504 = '2003' OR ed0504 = '2103' OR ed0504 = '2206' OR ed0504 = '2303' OR ed0504 = '2403') THEN 15
	WHEN (ed0504 = '2004' OR ed0504 = '2104' OR ed0504 = '2304' OR ed0504 = '2404') THEN 16
	WHEN (ed0504 = '2405') THEN 17
	WHEN (ed0504 = '2406') THEN 18
	WHEN (ed0504 = '8888') THEN 0
	WHEN (ed0504 = '9999') THEN 99
END
GO

SELECT AVG(CAST(a�oest AS FLOAT)) FROM RSH_BASE

SELECT formulario, a�oest, ed0504 FROM RSH_BASE
WHERE ed0504 = '1003'